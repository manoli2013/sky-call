var cov_2hazax7f2k=function(){var path="/home/noli/bootcamp/collab/skylab-bootcamp-201909/staff/noli-pascual/sky-call/sky-call-api/logic/general-report/index.spec.js";var hash="bd797d72f6ce109a5fb09c50a028852ec9edc5d1";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/noli/bootcamp/collab/skylab-bootcamp-201909/staff/noli-pascual/sky-call/sky-call-api/logic/general-report/index.spec.js",statementMap:{"0":{start:{line:1,column:0},end:{line:1,column:26}},"1":{start:{line:2,column:33},end:{line:2,column:40}},"2":{start:{line:3,column:19},end:{line:3,column:34}},"3":{start:{line:4,column:38},end:{line:4,column:62}},"4":{start:{line:5,column:23},end:{line:5,column:35}},"5":{start:{line:6,column:19},end:{line:6,column:23}},"6":{start:{line:7,column:74},end:{line:7,column:98}},"7":{start:{line:9,column:0},end:{line:174,column:2}},"8":{start:{line:10,column:4},end:{line:10,column:47}},"9":{start:{line:10,column:17},end:{line:10,column:46}},"10":{start:{line:18,column:4},end:{line:156,column:6}},"11":{start:{line:21,column:8},end:{line:21,column:33}},"12":{start:{line:22,column:8},end:{line:22,column:39}},"13":{start:{line:23,column:8},end:{line:23,column:41}},"14":{start:{line:24,column:8},end:{line:24,column:41}},"15":{start:{line:25,column:8},end:{line:25,column:22}},"16":{start:{line:28,column:8},end:{line:28,column:34}},"17":{start:{line:29,column:8},end:{line:29,column:40}},"18":{start:{line:30,column:8},end:{line:30,column:42}},"19":{start:{line:31,column:8},end:{line:31,column:42}},"20":{start:{line:32,column:8},end:{line:32,column:23}},"21":{start:{line:35,column:8},end:{line:35,column:30}},"22":{start:{line:39,column:8},end:{line:39,column:45}},"23":{start:{line:40,column:8},end:{line:40,column:51}},"24":{start:{line:41,column:8},end:{line:41,column:31}},"25":{start:{line:42,column:8},end:{line:42,column:39}},"26":{start:{line:43,column:8},end:{line:43,column:20}},"27":{start:{line:44,column:8},end:{line:44,column:19}},"28":{start:{line:47,column:8},end:{line:47,column:31}},"29":{start:{line:48,column:8},end:{line:48,column:28}},"30":{start:{line:49,column:8},end:{line:49,column:23}},"31":{start:{line:51,column:8},end:{line:51,column:107}},"32":{start:{line:55,column:22},end:{line:55,column:54}},"33":{start:{line:56,column:8},end:{line:56,column:26}},"34":{start:{line:59,column:8},end:{line:59,column:99}},"35":{start:{line:61,column:8},end:{line:61,column:26}},"36":{start:{line:62,column:8},end:{line:62,column:25}},"37":{start:{line:65,column:22},end:{line:65,column:155}},"38":{start:{line:66,column:8},end:{line:66,column:26}},"39":{start:{line:69,column:23},end:{line:69,column:115}},"40":{start:{line:71,column:8},end:{line:71,column:28}},"41":{start:{line:78,column:28},end:{line:78,column:125}},"42":{start:{line:79,column:28},end:{line:79,column:125}},"43":{start:{line:80,column:28},end:{line:80,column:125}},"44":{start:{line:81,column:28},end:{line:81,column:125}},"45":{start:{line:82,column:28},end:{line:82,column:125}},"46":{start:{line:83,column:28},end:{line:83,column:125}},"47":{start:{line:85,column:8},end:{line:85,column:57}},"48":{start:{line:86,column:8},end:{line:86,column:57}},"49":{start:{line:87,column:8},end:{line:87,column:57}},"50":{start:{line:88,column:8},end:{line:88,column:57}},"51":{start:{line:89,column:8},end:{line:89,column:57}},"52":{start:{line:90,column:8},end:{line:90,column:57}},"53":{start:{line:91,column:8},end:{line:91,column:25}},"54":{start:{line:93,column:23},end:{line:93,column:118}},"55":{start:{line:94,column:23},end:{line:94,column:118}},"56":{start:{line:95,column:23},end:{line:95,column:118}},"57":{start:{line:96,column:23},end:{line:96,column:118}},"58":{start:{line:97,column:23},end:{line:97,column:118}},"59":{start:{line:98,column:23},end:{line:98,column:118}},"60":{start:{line:100,column:8},end:{line:100,column:52}},"61":{start:{line:101,column:8},end:{line:101,column:52}},"62":{start:{line:102,column:8},end:{line:102,column:52}},"63":{start:{line:103,column:8},end:{line:103,column:52}},"64":{start:{line:104,column:8},end:{line:104,column:52}},"65":{start:{line:105,column:8},end:{line:105,column:52}},"66":{start:{line:107,column:8},end:{line:107,column:25}},"67":{start:{line:111,column:22},end:{line:111,column:152}},"68":{start:{line:113,column:8},end:{line:113,column:27}},"69":{start:{line:116,column:28},end:{line:116,column:126}},"70":{start:{line:117,column:28},end:{line:117,column:126}},"71":{start:{line:118,column:28},end:{line:118,column:126}},"72":{start:{line:119,column:29},end:{line:119,column:127}},"73":{start:{line:120,column:29},end:{line:120,column:127}},"74":{start:{line:121,column:29},end:{line:121,column:127}},"75":{start:{line:123,column:8},end:{line:123,column:58}},"76":{start:{line:124,column:8},end:{line:124,column:58}},"77":{start:{line:125,column:8},end:{line:125,column:58}},"78":{start:{line:126,column:8},end:{line:126,column:59}},"79":{start:{line:127,column:8},end:{line:127,column:59}},"80":{start:{line:128,column:8},end:{line:128,column:59}},"81":{start:{line:129,column:8},end:{line:129,column:26}},"82":{start:{line:132,column:23},end:{line:132,column:119}},"83":{start:{line:133,column:23},end:{line:133,column:119}},"84":{start:{line:134,column:23},end:{line:134,column:119}},"85":{start:{line:135,column:24},end:{line:135,column:120}},"86":{start:{line:136,column:24},end:{line:136,column:120}},"87":{start:{line:137,column:24},end:{line:137,column:120}},"88":{start:{line:139,column:8},end:{line:139,column:53}},"89":{start:{line:140,column:8},end:{line:140,column:53}},"90":{start:{line:141,column:8},end:{line:141,column:53}},"91":{start:{line:142,column:8},end:{line:142,column:54}},"92":{start:{line:143,column:8},end:{line:143,column:54}},"93":{start:{line:144,column:8},end:{line:144,column:54}},"94":{start:{line:146,column:8},end:{line:146,column:26}},"95":{start:{line:148,column:22},end:{line:148,column:94}},"96":{start:{line:149,column:22},end:{line:149,column:93}},"97":{start:{line:151,column:22},end:{line:151,column:94}},"98":{start:{line:152,column:22},end:{line:152,column:93}},"99":{start:{line:154,column:22},end:{line:154,column:94}},"100":{start:{line:155,column:22},end:{line:155,column:93}},"101":{start:{line:158,column:4},end:{line:170,column:6}},"102":{start:{line:160,column:23},end:{line:160,column:52}},"103":{start:{line:161,column:8},end:{line:161,column:27}},"104":{start:{line:163,column:12},end:{line:163,column:52}},"105":{start:{line:164,column:12},end:{line:164,column:55}},"106":{start:{line:165,column:12},end:{line:165,column:54}},"107":{start:{line:166,column:12},end:{line:166,column:53}},"108":{start:{line:167,column:12},end:{line:167,column:52}},"109":{start:{line:168,column:12},end:{line:168,column:54}},"110":{start:{line:169,column:12},end:{line:169,column:75}},"111":{start:{line:173,column:4},end:{line:173,column:136}},"112":{start:{line:173,column:16},end:{line:173,column:135}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:9,column:35},end:{line:9,column:36}},loc:{start:{line:9,column:41},end:{line:174,column:1}},line:9},"1":{name:"(anonymous_1)",decl:{start:{line:10,column:11},end:{line:10,column:12}},loc:{start:{line:10,column:17},end:{line:10,column:46}},line:10},"2":{name:"(anonymous_2)",decl:{start:{line:18,column:15},end:{line:18,column:16}},loc:{start:{line:18,column:27},end:{line:156,column:5}},line:18},"3":{name:"(anonymous_3)",decl:{start:{line:158,column:44},end:{line:158,column:45}},loc:{start:{line:158,column:56},end:{line:170,column:5}},line:158},"4":{name:"(anonymous_4)",decl:{start:{line:173,column:10},end:{line:173,column:11}},loc:{start:{line:173,column:16},end:{line:173,column:135}},line:173}},branchMap:{},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"bd797d72f6ce109a5fb09c50a028852ec9edc5d1"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();cov_2hazax7f2k.s[0]++;require('dotenv').config();const{env:{TEST_DB_URL}}=(cov_2hazax7f2k.s[1]++,process);const{expect}=(cov_2hazax7f2k.s[2]++,require('chai'));const{errors:{NotFoundError}}=(cov_2hazax7f2k.s[3]++,require('sky-call-util'));const retrieveReport=(cov_2hazax7f2k.s[4]++,require('.'));const{random}=(cov_2hazax7f2k.s[5]++,Math);const{database,models:{User,Agent,Client,Route,Visit,Call}}=(cov_2hazax7f2k.s[6]++,require('sky-call-data'));cov_2hazax7f2k.s[7]++;describe('logic - general report',()=>{cov_2hazax7f2k.f[0]++;cov_2hazax7f2k.s[8]++;before(()=>{cov_2hazax7f2k.f[1]++;cov_2hazax7f2k.s[9]++;return database.connect(TEST_DB_URL);});let user;let name,surname,username,password,role;let name1,surname1,username1,password1,role1;let idClient,nameClient,surnameClient,tel,address,callIds,visits;let location;let dateRegister,dateVisit,status;cov_2hazax7f2k.s[10]++;beforeEach(async()=>{cov_2hazax7f2k.f[2]++;cov_2hazax7f2k.s[11]++;//create user
name=`name-${random()}`;cov_2hazax7f2k.s[12]++;surname=`surname-${random()}`;cov_2hazax7f2k.s[13]++;username=`username-${random()}`;cov_2hazax7f2k.s[14]++;password=`password-${random()}`;cov_2hazax7f2k.s[15]++;role='agent';//create user1
cov_2hazax7f2k.s[16]++;name1=`name-${random()}`;cov_2hazax7f2k.s[17]++;surname1=`surname-${random()}`;cov_2hazax7f2k.s[18]++;username1=`username-${random()}`;cov_2hazax7f2k.s[19]++;password1=`password-${random()}`;cov_2hazax7f2k.s[20]++;role1='agent';//crear ruta
cov_2hazax7f2k.s[21]++;location='Barcelona';//crear cliente
cov_2hazax7f2k.s[22]++;nameClient=`nameClient-${random()}`;cov_2hazax7f2k.s[23]++;surnameClient=`surnameClient-${random()}`;cov_2hazax7f2k.s[24]++;tel=`tel-${random()}`;cov_2hazax7f2k.s[25]++;address=`address-${random()}`;cov_2hazax7f2k.s[26]++;callIds=[];cov_2hazax7f2k.s[27]++;visits=[];//crear visitas
cov_2hazax7f2k.s[28]++;dateRegister=new Date();cov_2hazax7f2k.s[29]++;dateVisit=new Date();cov_2hazax7f2k.s[30]++;status='PDTE';cov_2hazax7f2k.s[31]++;await Promise.all([User.deleteMany(),Client.deleteMany(),Route.deleteMany(),Visit.deleteMany()]);//crear en mongo
const route=(cov_2hazax7f2k.s[32]++,await Route.create({location}));cov_2hazax7f2k.s[33]++;idRoute=route.id;//user
cov_2hazax7f2k.s[34]++;user=await User.create({name,surname,username,password,role,profile:new Agent()});cov_2hazax7f2k.s[35]++;location=idRoute;cov_2hazax7f2k.s[36]++;idAgent=user.id;//admin
const admin=(cov_2hazax7f2k.s[37]++,await User.create({name:'adminName',surname:'adminSurname',username:'adminSurname',password:'adminPassword',role:'admin'}));cov_2hazax7f2k.s[38]++;idAdmin=admin.id;//cliente
const client=(cov_2hazax7f2k.s[39]++,await Client.create({creator:idAgent,nameClient,surnameClient,tel,location,address}));cov_2hazax7f2k.s[40]++;idClient=client.id;//llamadas
//visitas user1
let pendingVisit1=(cov_2hazax7f2k.s[41]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'PDTE'}));let pendingVisit2=(cov_2hazax7f2k.s[42]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'PDTE'}));let pendingVisit3=(cov_2hazax7f2k.s[43]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'PDTE'}));let pendingVisit4=(cov_2hazax7f2k.s[44]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'PDTE'}));let pendingVisit5=(cov_2hazax7f2k.s[45]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'PDTE'}));let pendingVisit6=(cov_2hazax7f2k.s[46]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'PDTE'}));cov_2hazax7f2k.s[47]++;user.profile.pendingVisits.push(pendingVisit1.id);cov_2hazax7f2k.s[48]++;user.profile.pendingVisits.push(pendingVisit2.id);cov_2hazax7f2k.s[49]++;user.profile.pendingVisits.push(pendingVisit3.id);cov_2hazax7f2k.s[50]++;user.profile.pendingVisits.push(pendingVisit4.id);cov_2hazax7f2k.s[51]++;user.profile.pendingVisits.push(pendingVisit5.id);cov_2hazax7f2k.s[52]++;user.profile.pendingVisits.push(pendingVisit6.id);cov_2hazax7f2k.s[53]++;await user.save();let okVisit1=(cov_2hazax7f2k.s[54]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'OK'}));let okVisit2=(cov_2hazax7f2k.s[55]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'OK'}));let okVisit3=(cov_2hazax7f2k.s[56]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'OK'}));let okVisit4=(cov_2hazax7f2k.s[57]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'OK'}));let okVisit5=(cov_2hazax7f2k.s[58]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'OK'}));let okVisit6=(cov_2hazax7f2k.s[59]++,await Visit.create({agent:idAgent,client:idClient,dateRegister,dateVisit,status:'OK'}));cov_2hazax7f2k.s[60]++;user.profile.successVisits.push(okVisit1.id);cov_2hazax7f2k.s[61]++;user.profile.successVisits.push(okVisit2.id);cov_2hazax7f2k.s[62]++;user.profile.successVisits.push(okVisit3.id);cov_2hazax7f2k.s[63]++;user.profile.successVisits.push(okVisit4.id);cov_2hazax7f2k.s[64]++;user.profile.successVisits.push(okVisit5.id);cov_2hazax7f2k.s[65]++;user.profile.successVisits.push(okVisit6.id);cov_2hazax7f2k.s[66]++;await user.save();//user2
const user2=(cov_2hazax7f2k.s[67]++,await User.create({name:name1,surname:surname1,username:username1,password:password1,role:role1,profile:new Agent()}));cov_2hazax7f2k.s[68]++;idAgent2=user2.id;//visitas user1
let pendingVisit7=(cov_2hazax7f2k.s[69]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'PDTE'}));let pendingVisit8=(cov_2hazax7f2k.s[70]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'PDTE'}));let pendingVisit9=(cov_2hazax7f2k.s[71]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'PDTE'}));let pendingVisit10=(cov_2hazax7f2k.s[72]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'PDTE'}));let pendingVisit11=(cov_2hazax7f2k.s[73]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'PDTE'}));let pendingVisit12=(cov_2hazax7f2k.s[74]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'PDTE'}));cov_2hazax7f2k.s[75]++;user2.profile.pendingVisits.push(pendingVisit7.id);cov_2hazax7f2k.s[76]++;user2.profile.pendingVisits.push(pendingVisit8.id);cov_2hazax7f2k.s[77]++;user2.profile.pendingVisits.push(pendingVisit9.id);cov_2hazax7f2k.s[78]++;user2.profile.pendingVisits.push(pendingVisit10.id);cov_2hazax7f2k.s[79]++;user2.profile.pendingVisits.push(pendingVisit11.id);cov_2hazax7f2k.s[80]++;user2.profile.pendingVisits.push(pendingVisit12.id);cov_2hazax7f2k.s[81]++;await user2.save();let okVisit7=(cov_2hazax7f2k.s[82]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'OK'}));let okVisit8=(cov_2hazax7f2k.s[83]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'OK'}));let okVisit9=(cov_2hazax7f2k.s[84]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'OK'}));let okVisit10=(cov_2hazax7f2k.s[85]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'OK'}));let okVisit11=(cov_2hazax7f2k.s[86]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'OK'}));let okVisit12=(cov_2hazax7f2k.s[87]++,await Visit.create({agent:idAgent2,client:idClient,dateRegister,dateVisit,status:'OK'}));cov_2hazax7f2k.s[88]++;user2.profile.successVisits.push(okVisit7.id);cov_2hazax7f2k.s[89]++;user2.profile.successVisits.push(okVisit8.id);cov_2hazax7f2k.s[90]++;user2.profile.successVisits.push(okVisit9.id);cov_2hazax7f2k.s[91]++;user2.profile.successVisits.push(okVisit10.id);cov_2hazax7f2k.s[92]++;user2.profile.successVisits.push(okVisit11.id);cov_2hazax7f2k.s[93]++;user2.profile.successVisits.push(okVisit12.id);cov_2hazax7f2k.s[94]++;await user2.save();const call1=(cov_2hazax7f2k.s[95]++,await Call.create({agent:idAgent,client:idClient,statusCall:'N.A'}));const call2=(cov_2hazax7f2k.s[96]++,await Call.create({agent:idAgent2,client:idClient,statusCall:'A'}));const call3=(cov_2hazax7f2k.s[97]++,await Call.create({agent:idAgent,client:idClient,statusCall:'N.A'}));const call4=(cov_2hazax7f2k.s[98]++,await Call.create({agent:idAgent2,client:idClient,statusCall:'A'}));const call5=(cov_2hazax7f2k.s[99]++,await Call.create({agent:idAgent,client:idClient,statusCall:'N.A'}));const call6=(cov_2hazax7f2k.s[100]++,await Call.create({agent:idAgent2,client:idClient,statusCall:'A'}));});cov_2hazax7f2k.s[101]++;it('should succeed listing all agents',async()=>{cov_2hazax7f2k.f[3]++;const report=(cov_2hazax7f2k.s[102]++,await retrieveReport(idAdmin));cov_2hazax7f2k.s[103]++;console.log(report);cov_2hazax7f2k.s[104]++;expect(report.calls).that.is.a('number');cov_2hazax7f2k.s[105]++;expect(report.answered).that.is.a('number');cov_2hazax7f2k.s[106]++;expect(report.pending).that.is.a('number');cov_2hazax7f2k.s[107]++;expect(report.visits).that.is.a('number');cov_2hazax7f2k.s[108]++;expect(report.fails).that.is.a('number');cov_2hazax7f2k.s[109]++;expect(report.calling).that.is.a('number');cov_2hazax7f2k.s[110]++;expect(report.calls).to.equal(report.answered+report.pending);});cov_2hazax7f2k.s[111]++;after(()=>{cov_2hazax7f2k.f[4]++;cov_2hazax7f2k.s[112]++;return Promise.all([User.deleteMany(),Client.deleteMany(),Route.deleteMany(),Visit.deleteMany()]).then(database.disconnect);});});